var App={testing_on_desktop:false,device_model:null,device_platform:null,device_version:null,device_uuid:null,device_cordova:null,screen_width:null,screen_height:null,screen_availWidth:null,screen_availHeight:null,screen_colorDepth:null,camera_pictureSource:null,camera_destinationType:null,network_connectionType:null,initialize:function(){console.log("Initializing Apps");App.bindEvents();},bindEvents:function(){if(document.URL.indexOf("http://")==0){App.testing_on_desktop=true;}$(document).ready(function(){$(document).bind("mobileinit",function(){$.support.cors=true;$.mobile.allowCrossDomainPages=true;$.mobile.phonegapNavigationEnabled=false;$.mobile.defaultDialogTransition="pop";$.mobile.defaultPageTransition="none";$.mobile.loader.prototype.options.text="loading";$.mobile.loader.prototype.options.textVisible=true;$.mobile.loader.prototype.options.theme="b";});console.log("jQuery finished loading");var b=$.Deferred();var a=$.Deferred();if(App.testing_on_desktop){App.onDeviceReady();b.resolve();}else{document.addEventListener("deviceReady",function(){App.onDeviceReady();b.resolve();},false);}jQuery(document).one("pageinit",function(){console.log("jQuery.Mobile finished loading");a.resolve();});jQuery.when(b,a).then(function(){App.initPages();});$.when(b,a).then(App.initPages);});},onDeviceReady:function(){console.log("PhoneGap finished loading");App.device_model=device.model;App.device_platform=device.platform;App.device_version=device.version;App.device_uuid=device.uuid;App.device_cordova=device.cordova;App.screen_width=screen.width;App.screen_height=screen.height;App.screen_availWidth=screen.availWidth;App.screen_availHeight=screen.availHeight;App.screen_colorDepth=screen.colorDepth;App.camera_pictureSource=navigator.camera.PictureSourceType;App.camera_destinationType=navigator.camera.DestinationType;App.network_connectionType=navigator.network.connection.type;},initPages:function(){console.log("App finished loading");FastClick.attach(document.body);},data:{isNull:function(a){return a==null?0:(a[1]||0);},isUndefined:function(a){if(typeof(a)==="undefined"){return"-";}},numLength:function(a,b){var b=""+b;if(b.length<a){for(i=1;i<a;i++){b="0"+b;}}return b;},roundNumber:function(a,b){return Math.round(a*Math.pow(10,b))/Math.pow(10,b);},showError:function(a){console.log("[App.data.showError]");var b="code: "+a.code+"\nmessage: "+a.message+"\n";navigator.notification.alert(b,null,"ERROR","OK");},notifyLogin:function(){var a=document.getElementById("user-info");a.innerHTML="<p><label><b>Welcome!</b></label><label>You have logged in as "+App.feature.storage.username+".</label><label>Click <a href='#' onclick='logout()'>here</a> to logout.</label></p>";navigator.notification.beep(2);}},feature:{reachability:function(){if(navigator.network.connection.type==Connection.NONE||navigator.network.connection.type==Connection.UNKNOWN){return false;}else{return true;}},deviceInfo:{showData:function(){console.log("[App.feature.deviceInfo.showData]");var a={};a[Connection.UNKNOWN]="Unknown connection";a[Connection.ETHERNET]="Ethernet connection";a[Connection.WIFI]="WiFi connection";a[Connection.CELL_2G]="Cell 2G connection";a[Connection.CELL_3G]="Cell 3G connection";a[Connection.CELL_4G]="Cell 4G connection";a[Connection.NONE]="No network connection";document.getElementById("device-status-bar").setAttribute("style","display: none !important;");document.getElementById("device-model").innerHTML=App.device_model;document.getElementById("device-uuid").innerHTML=App.device_uuid;document.getElementById("device-platform").innerHTML=App.device_platform;document.getElementById("device-version").innerHTML=App.device_version;document.getElementById("device-cordova").innerHTML=App.device_cordova;document.getElementById("network-connection").innerHTML=a[App.network_connectionType];document.getElementById("screen-width").innerHTML=App.screen_width;document.getElementById("screen-height").innerHTML=App.screen_height;document.getElementById("screen-availWidth").innerHTML=App.screen_availWidth;document.getElementById("screen-availHeight").innerHTML=App.screen_availHeight;document.getElementById("screen-colorDepth").innerHTML=App.screen_colorDepth;document.getElementById("device-details").setAttribute("style","display: block !important;");}},accelerometer:{watchID:null,oCan:null,oImg:null,xPos:null,yPos:null,showData:function(e){console.log("[App.feature.accelerometer.showData]");var f=e.x;var c=e.y;var a=e.z;var g=new Date(e.timestamp);var b=g.getFullYear()+"-"+g.getMonth()+"-"+g.getDate();b+=" "+g.getHours()+":"+App.data.numLength(2,g.getMinutes())+":"+App.data.numLength(2,g.getSeconds());document.getElementById("accelerometer-status-bar").innerHTML="Watching device orientation...";document.getElementById("xVal").innerHTML=App.data.roundNumber(f,5);document.getElementById("yVal").innerHTML=App.data.roundNumber(c,5);document.getElementById("zVal").innerHTML=App.data.roundNumber(a,5);document.getElementById("date").innerHTML=b+"";document.getElementById("accelerometer-details").setAttribute("style","display: block !important;");App.feature.accelerometer.moveObject(f,c);},moveObject:function(d,b){var c=App.feature.accelerometer;xPos=c.xPos+(-1*(d*1.5))/2;yPos=c.yPos+(b*1.5)/2;var a=c.oCan.getContext("2d");a.clearRect(0,0,c.oCan.width,c.oCan.height);a.drawImage(c.oImg,xPos,yPos,50,50);},createObject:function(){var b=App.feature.accelerometer;b.oCan=document.getElementById("myCanvas");var a=b.oCan.getContext("2d");a.clearRect(0,0,b.oCan.width,b.oCan.height);b.oImg=new Image();b.oImg.src="css/images/football.png";b.oCan.height=b.oCan.width;b.xPos=(b.oCan.width-b.oImg.width)/2;b.yPos=(b.oCan.height-b.oImg.height)/2;b.oImg.onload=function(){a.drawImage(b.oImg,b.xPos,b.yPos,50,50);};},startService:function(){console.log("[App.feature.accelerometer.startService]");App.feature.accelerometer.createObject();var a={frequency:50};if(!App.feature.accelerometer.watchID){App.feature.accelerometer.watchID=navigator.accelerometer.watchAcceleration(App.feature.accelerometer.showData,App.data.showError,a);}},stopService:function(){console.log("[App.feature.accelerometer.stopService]");navigator.accelerometer.clearWatch(App.feature.accelerometer.watchID);App.feature.accelerometer.watchID=null;document.getElementById("accelerometer-status-bar").innerHTML="Device orientation watch stopped...";document.getElementById("toogleAccelerometer").innerHTML="Start watching";},toogleAccelerometer:function(){var a=App.feature.accelerometer;if(a.watchID!=null){a.stopService();}else{a.startService();document.getElementById("toogleAccelerometer").innerHTML="Stop watching";}}},camera:{startService:function(){console.log("[App.feature.camera.startService]");},onPhotoDataSuccess:function(e){console.log("[App.feature.camera.onPhotoDataSuccess]");var d=document.getElementById("img-frame");var b=d.width-2;var c=d.Height-2;var a=document.getElementById("img-preview");a.width=b+"px";a.Height=c+"px";a.style.display="block";a.style.visibility="visible";a.src="data:image/jpeg;base64,"+e;},onPhotoURISuccess:function(b){console.log("[App.feature.camera.onPhotoURISuccess]");var a=document.getElementById("img-preview");a.style.display="block";a.style.visibility="visible";a.src=b;},capturePhoto:function(){console.log("[App.feature.camera.capturePhoto]");var a={quality:30,destinationType:App.camera_destinationType.DATA_URL,encodingType:Camera.EncodingType.JPEG,targetHeight:200,saveToPhotoAlbum:true};navigator.camera.getPicture(App.feature.camera.onPhotoDataSuccess,App.data.showError,a);},openPhotoAlbum:function(){console.log("[App.feature.camera.openPhotoAlbum]");var a={quality:30,destinationType:App.App.camera_destinationType.FILE_URI,sourceType:App.camera_pictureSource.SAVEDPHOTOALBUM};navigator.camera.getPicture(App.feature.camera.onPhotoURISuccess,App.data.showError,a);}},geolocation:{watchID:null,createMarker:function(d,b,e){console.log("[App.feature.geolocation.createMarker]");var a=new google.maps.Marker({map:d,position:b,zIndex:90,optimized:false,title:e});var c=new google.maps.InfoWindow();google.maps.event.addListener(a,"click",function(){c.setContent(e);c.open(d,this);});return a;},showMap:function(b){console.log("[App.feature.geolocation.showMap]");var f=b.coords.latitude;var c=b.coords.longitude;var d=document.getElementById("map-frame");var g=new google.maps.LatLng(f,c);var e=new google.maps.Map(d,{mapTypeId:google.maps.MapTypeId.ROADMAP,center:g,zoom:14});var a=App.feature.geolocation.createMarker(e,g,"YOU ARE HERE");iconFile="css/images/green-dot.png";a.setIcon(iconFile);},showData:function(a){console.log("[App.feature.geolocation.showData]");var e=a.coords.latitude;var b=a.coords.longitude;var d=a.coords.altitude;var c=a.coords.accuracy;document.getElementById("geolocation-status-bar").setAttribute("style","display: none !important;");document.getElementById("lat").innerHTML=e+"(watching)";document.getElementById("lng").innerHTML=b;document.getElementById("alt").innerHTML=d;document.getElementById("acc").innerHTML=c+"m";document.getElementById("geolocation-details").setAttribute("style","display: block !important;");App.feature.geolocation.showMap(a);},startService:function(){console.log("[App.feature.geolocation.startService]");if(!App.feature.reachability()){navigator.notification.alert("No internet connection available",null,"","OK");}else{var a={frequency:2000,enableHighAccuracy:true};App.feature.geolocation.watchID=navigator.geolocation.watchPosition(App.feature.geolocation.showData,App.data.showError,a);}},stopService:function(){console.log("[App.feature.geolocation.stopService]");navigator.geolocation.clearWatch(App.feature.geolocation.watchID);App.feature.geolocation.watchID=null;document.getElementById("toogleGeolocation").innerHTML="Start watching";},toogleGeolocation:function(){var a=App.feature.geolocation;if(a.watchID!=null){a.stopService();}else{a.startService();document.getElementById("toogleGeolocation").innerHTML="Stop watching";}}},contacts:{showContacts:function(d){console.log("[App.feature.contacts.showContacts]");var c=document.getElementById("contact-list");c.innerHTML="<strong>"+d.length+"</strong> contacts found, but showing contacts with phone numbers only.<br/>";for(var b=0;b<d.length;b++){if(d[b].phoneNumbers){c.innerHTML+="<br/> ["+(b+1)+"] <strong>"+d[b].displayName+"</strong>";for(var a=0;a<d[b].phoneNumbers.length;a++){c.innerHTML+=" : "+d[b].phoneNumbers[a].value+"("+d[b].phoneNumbers[a].type+")";}}}},startService:function(){console.log("[App.feature.contacts.startService]");var a=new ContactFindOptions();a.filter="";a.multiple=true;var b=["displayName","name","phoneNumbers"];navigator.contacts.find(b,App.feature.contacts.showContacts,App.data.showError,a);}},media:{myMedia:null,mediaTimer:null,playAudio:function(){var b="data/audio/sample.mp3";var a=App.feature.media;a.myMedia=new Media(b,a.onSuccess,App.data.onError);a.myMedia.play();if(a.mediaTimer==null){a.mediaTimer=setInterval(function(){a.myMedia.getCurrentPosition(function(c){if(c>-1){a.setAudioPosition((c)+" sec");}},function(c){console.log("Error getting pos="+c);a.setAudioPosition("Error: "+c);});},1000);}},pauseAudio:function(){var a=App.feature.media;if(a.myMedia){a.myMedia.pause();}},stopAudio:function(){var a=App.feature.media;if(a.myMedia){a.myMedia.stop();}clearInterval(a.mediaTimer);a.mediaTimer=null;},onSuccess:function(){console.log("playAudio():Audio Success");},setAudioPosition:function(a){document.getElementById("audio-position").innerHTML=a;}},storage:{db:0,tblName:null,tblFields:null,tblValues:null,createTbl:function(a){a.executeSql("DROP TABLE IF EXISTS "+App.feature.storage.tblName);a.executeSql("CREATE TABLE IF NOT EXISTS "+App.feature.storage.tblName+" ("+App.feature.storage.tblFields+")");},insertData:function(a){a.executeSql("INSERT INTO "+App.feature.storage.tableName+" ("+App.feature.storage.tblFields+") VALUES ("+App.feature.storage.tblValues+")");},deleteTbl:function(a){a.executeSql("DROP TABLE IF EXISTS "+App.feature.storage.tblName);},createDb:function(){if(!App.feature.storage.db){App.feature.storage.db=window.openDatabase("Database","1.0","MyDatabase",200000);}}}}};$(document).on("pageshow","#home",function(){$(document).on("click","#login",function(b){var c=$("#username").val();var a=$("#password").val();if(c.length>0&&a.length>0){navigator.notification.alert("Processing...",null,"","OK");if(!App.feature.reachability()){navigator.notification.alert("No internet connection available",null,"ERROR","OK");}else{$.ajax({url:"http://localhost/SoapWebServiceForMobileApp/login.php?callback=myCallBack",type:"POST",crossDomain:true,data:{username:c,password:a},contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallbackfunction",success:function(d){if(d=="success"){var e=App.feature.storage;e.tblName="USER";e.tblfields="USERNAME";e.tblValues=username;e.db.transaction(createTable,App.data.showError);e.db.transaction(insertData,App.data.showError,App.data.notifyLogin);}else{navigator.notification.vibrate(0);navigator.notification.alert(d,null,"","OK");}},error:function(f,e,d){navigator.notification.alert("Some error occurred. Please try again later.",null,"ERROR","OK");}});}}else{navigator.notification.alert("Please provide the required login details.",null,"ERROR","Login");}});$(document).on("click","#register",function(d){var f=$("#username").val();var c=$("#password").val();var b=$("#confirmPassword").val();var a=$("#email").val();if(f.length>0&&c.length>0&&a.length>0){if(c==b){navigator.notification.alert("Processing...",null,"","OK");if(!App.feature.reachability()){navigator.notification.alert("No internet connection available",null,"ERROR","OK");}else{$.ajax({url:"http://localhost/SoapWebServiceForMobileApp/register.php?callback=myCallBack",type:"POST",crossDomain:true,data:{username:f,password:c,email:a},contentType:"application/json; charset=utf-8",dataType:"jsonp",jsonp:"callback",jsonpCallback:"jsonpCallbackfunction",success:function(e){navigator.notification.alert(e,null,"","OK");},error:function(h,g,e){navigator.notification.alert("Some error occurred. Please try again later.",null,"","OK");}});}}else{navigator.notification.alert("Password does not match.",null,"ERROR","OK");}}else{navigator.notification.alert("Please provide the required login details.",null,"ERROR","OK");}});});function userRegistrationDisplay(){document.getElementById("userRegistrationSection").setAttribute("style","display: block !important;");document.getElementById("userLoginLink").setAttribute("style","display: block !important;");document.getElementById("userLoginSection").setAttribute("style","display: none !important;");document.getElementById("userRegistrationLink").setAttribute("style","display: none !important;");}function userLoginDisplay(){document.getElementById("userLoginSection").setAttribute("style","display: block !important;");document.getElementById("userRegistrationLink").setAttribute("style","display: block !important;");document.getElementById("userRegistrationSection").setAttribute("style","display: none !important;");document.getElementById("userLoginLink").setAttribute("style","display: none !important;");}